{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import QrReader from\"react-qr-reader\";import API from\"../../utils/API\";import HandleForm from\"./HandleForm\";import SystemMessage from\"./SystemMessage\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Scaner(_ref){var openScaner=_ref.openScaner,setForm=_ref.setForm,setScanerForm=_ref.setScanerForm,scanerForm=_ref.scanerForm;var _useState=useState('No result'),_useState2=_slicedToArray(_useState,2),result=_useState2[0],setResult=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],showMessage=_useState4[1];var _useState5=useState(window.localStorage.getItem(\"userToken\")),_useState6=_slicedToArray(_useState5,2),token=_useState6[0],setToken=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),isScannerWork=_useState8[0],setScanerWork=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),name=_useState10[0],setName=_useState10[1];var closeAll=function closeAll(){openScaner(false);setScanerForm(false);setForm(false);document.querySelector(\"#root\").classList.remove(\"scrolled\");};var scan=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var fn,fp,doc_number,date;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!data){_context.next=9;break;}setResult(data);setScanerWork(false);fn=data.slice(data.indexOf(\"fn=\")+3,data.indexOf(\"&i=\"));fp=data.slice(data.indexOf(\"fp=\")+3,data.indexOf(\"&n=\"));doc_number=data.slice(data.indexOf(\"&i=\")+3,data.indexOf(\"&fp=\"));date=data.slice(data.indexOf(\"t=\")+2,data.indexOf(\"&s=\"));_context.next=9;return API.post(\"/checks\",{date:date,fn:fn,fp:fp,doc_number:doc_number},{headers:{\"Authorization\":\"Bearer \".concat(token)}}).then(function(response){if(response.data.success){showMessage(response.data.message);setName(\"\\u0427\\u0435\\u043A \\u043F\\u0440\\u0438\\u043D\\u044F\\u0442\");}else{showMessage(response.data.message);setName(\"\\u0427\\u0435\\u043A \\u043D\\u0435 \\u043F\\u0440\\u0438\\u043D\\u044F\\u0442\");}},function(error){showMessage(\"Qr-код, который вы сканируете, не прошел валидацию\");setName(\"\\u0427\\u0435\\u043A \\u043D\\u0435 \\u043F\\u0440\\u0438\\u043D\\u044F\\u0442\");});case 9:case\"end\":return _context.stop();}}},_callee);}));return function scan(_x){return _ref2.apply(this,arguments);};}();var handleScan=function handleScan(){setScanerForm(true);};var handleClick=function handleClick(){openScaner(false);document.querySelector('#root').classList.remove('scrolled');};return/*#__PURE__*/_jsx(\"div\",{className:\"container-fluid\",children:/*#__PURE__*/_jsx(\"div\",{className:\"scaner__box\",children:scanerForm?/*#__PURE__*/_jsx(HandleForm,{setForm:setForm,setScanerForm:setScanerForm,openScaner:openScaner}):/*#__PURE__*/_jsx(_Fragment,{children:!message?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"header\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row justify-content-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-auto \",children:/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0421\\u043A\\u0430\\u043D\\u0435\\u0440 \\u0448\\u0442\\u0440\\u0438\\u0445\\u043A\\u043E\\u0434\\u043E\\u0432\"})})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"close-btn__container cursor-pointer\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"close-btn\",onClick:function onClick(){return handleClick();},children:[/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{})]})}),isScannerWork&&/*#__PURE__*/_jsx(QrReader,{delay:300,onScan:scan}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn mb-8 absol\",onClick:function onClick(){return handleScan();},children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0432\\u0432\\u0435\\u0441\\u0442\\u0438 \\u0432\\u0440\\u0443\\u0447\\u043D\\u0443\\u044E\"})]})]}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"handleScanContainer flex flex-col\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"close-btn__container cursor-pointer\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"close-btn\",onClick:function onClick(){return handleClick();},children:[/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{})]})}),/*#__PURE__*/_jsx(SystemMessage,{data:{message:name,description:message}}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn mb-8 mt-8 mx-auto\",onClick:function onClick(){return closeAll();},children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u043F\\u043E\\u043D\\u044F\\u0442\\u043D\\u043E\"})]})]})})})})});}","map":{"version":3,"sources":["/Users/alexandrach/Projects/tresnutye2021/src/components/Scaner/index.jsx"],"names":["React","useEffect","useState","QrReader","API","HandleForm","SystemMessage","Scaner","openScaner","setForm","setScanerForm","scanerForm","result","setResult","message","showMessage","window","localStorage","getItem","token","setToken","isScannerWork","setScanerWork","name","setName","closeAll","document","querySelector","classList","remove","scan","data","fn","slice","indexOf","fp","doc_number","date","post","headers","then","response","success","error","handleScan","handleClick","description"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport QrReader from \"react-qr-reader\";\nimport API from \"../../utils/API\";\nimport HandleForm from \"./HandleForm\";\nimport SystemMessage from \"./SystemMessage\";\n\n\nexport default function Scaner({ openScaner, setForm, setScanerForm, scanerForm }) {\n    const [result, setResult] = useState('No result');\n    const [message, showMessage] = useState(false);\n    const [token, setToken] = useState(window.localStorage.getItem(\"userToken\"));\n    const [isScannerWork, setScanerWork] = useState(true)\n    const [name, setName] = useState(null)\n\n    const closeAll = () => {\n        openScaner(false);\n        setScanerForm(false);\n        setForm(false);\n        document.querySelector(\"#root\").classList.remove(\"scrolled\");\n    };\n\n\n    const scan = async (data) => {\n        if (data) {\n            setResult(data)\n            setScanerWork(false)\n\n            const fn = data.slice(data.indexOf(\"fn=\") + 3, data.indexOf(\"&i=\"));\n            const fp = data.slice(data.indexOf(\"fp=\") + 3, data.indexOf(\"&n=\"));\n            const doc_number = data.slice(\n                data.indexOf(\"&i=\") + 3,\n                data.indexOf(\"&fp=\")\n            );\n            const date = data.slice(data.indexOf(\"t=\") + 2, data.indexOf(\"&s=\"));\n\n\n            await API.post(\"/checks\", {\n                date,\n                fn,\n                fp,\n                doc_number,\n            }, { headers: { \"Authorization\": `Bearer ${token}` } })\n                .then(\n                    (response) => {\n                        if (response.data.success) {\n                            showMessage(response.data.message)\n                            setName(`Чек принят`)\n                        }\n                        else {\n                            showMessage(response.data.message)\n                            setName(`Чек не принят`)\n                        }\n                    },\n                    (error) => {\n                        showMessage(\"Qr-код, который вы сканируете, не прошел валидацию\")\n                        setName(`Чек не принят`)\n                    }\n                );\n        }\n    };\n    const handleScan = () => {\n        setScanerForm(true);\n    };\n    const handleClick = () => {\n        openScaner(false);\n        document.querySelector('#root').classList.remove('scrolled');\n\n    };\n    return (\n        <div className=\"container-fluid\">\n            <div className=\"scaner__box\">\n                {scanerForm ? (\n                    <HandleForm\n                        setForm={setForm}\n                        setScanerForm={setScanerForm}\n                        openScaner={openScaner}\n                    />\n                ) : (\n                    <>\n                        {!message ? (\n                            <>\n                                <header>\n                                    <div className=\"container\">\n                                        <div className=\"row justify-content-center\">\n                                            <div className=\"col-lg-auto \">\n                                                <h3>Сканер штрихкодов</h3>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </header>\n                                <div className=\"close-btn__container cursor-pointer\">\n                                    <div\n                                        className=\"close-btn\"\n                                        onClick={() => handleClick()}\n                                    >\n                                        <span></span>\n                                        <span></span>\n                                    </div>\n                                </div>\n                                {isScannerWork && (\n                                    <QrReader\n                                        delay={300}\n                                        onScan={scan}\n                                    />\n                                )}\n                                <button className='btn mb-8 absol' onClick={() => handleScan()}>\n                                    <div className='bg'></div>\n                                    <span >ввести вручную</span>\n                                </button>\n                            </>\n                        ) : (\n                            <>\n                                <div className=\"handleScanContainer flex flex-col\">\n                                    <div className=\"close-btn__container cursor-pointer\">\n                                        <div\n                                            className=\"close-btn\"\n                                            onClick={() => handleClick()}\n                                        >\n                                            <span></span>\n                                            <span></span>\n                                        </div>\n                                    </div>\n                                    <SystemMessage\n                                        data={{\n                                            message: name,\n                                            description: message,\n                                        }}\n                                    />\n                                    <button className='btn mb-8 mt-8 mx-auto' onClick={() => closeAll()}>\n                                        <div className='bg'></div>\n                                        <span>понятно</span>\n                                    </button>\n                                </div>\n                            </>\n                        )}\n                    </>\n                )}\n            </div>\n        </div>\n\n    )\n}\n"]},"metadata":{},"sourceType":"module"}