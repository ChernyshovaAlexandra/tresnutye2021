{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import InputMask from\"react-input-mask\";import API from\"../../utils/API\";import arr from'../../assets/img/btn-arr.png';import Countdown from'react-countdown';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function LoginForm(_ref){var setToken=_ref.setToken,setForm=_ref.setForm;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),timer=_useState2[0],setTimer=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),code=_useState4[0],setCode=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),phoneNumber=_useState6[0],setPhone=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setErrorMessage=_useState8[1];var renderer=function renderer(_ref2){var seconds=_ref2.seconds,completed=_ref2.completed;if(completed){return/*#__PURE__*/_jsx(Completionist,{});}else{return/*#__PURE__*/_jsx(\"div\",{className:\"formCodeAgain\",children:timer==='ended'?/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 mx-auto text-center\",children:\"\\u041A\\u043E\\u0434 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u043D\\u043E\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 mx-auto text-center\",children:[\"\\u041F\\u043E\\u0432\\u0442\\u043E\\u0440\\u043D\\u0430\\u044F \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430 \\u0432\\u043E\\u0437\\u043C\\u043E\\u0436\\u043D\\u0430 \\u0447\\u0435\\u0440\\u0435\\u0437\",' ',/*#__PURE__*/_jsx(\"span\",{className:\"text-violet\",children:seconds}),\" \\u0441\\u0435\\u043A\"]})});}};var Completionist=function Completionist(){return/*#__PURE__*/_jsx(\"a\",{className:\"underline hover:no-underline text-violet  text-center mt-4 mx-auto block\",onClick:function onClick(){return stopTimer();},children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u043D\\u043E\"});};var startTimer=function startTimer(e){setTimer(true);};// Код отправлен повторно\nvar stopTimer=function stopTimer(){setTimer('ended');getCode();};var setCorrectCode=function setCorrectCode(e){setCode(e.target.value);};var getCode=function getCode(e){e&&e.preventDefault();API.post('/login_sms',{phone:phoneNumber}).then(function(res){var success=res.data.success;console.log(success);if(success){startTimer();// document.getElementById('#user_phone').value = ''\n}else if(!success){res.data.message?setErrorMessage(res.data.message):false;}}).catch(function(error){console.log(error);error.message&&setErrorMessage(error.message);});};var login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return API.post('/sms',{phone:phoneNumber,confirm_code:code}).then(function(res){var _res$data=res.data,success=_res$data.success,token=_res$data.token;if(success){setToken(token);window.localStorage.setItem('tresnutye2021-token',token);}});case 2:case\"end\":return _context.stop();}}},_callee);}));return function login(){return _ref3.apply(this,arguments);};}();var setCorrectPhone=function setCorrectPhone(e){setErrorMessage(false);var cur=e.target.value;cur=cur.replaceAll(/\\s/g,'').replaceAll(/[{()}]/g,'').replaceAll('+','');setPhone(cur);setCode('');};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-violet text-center text-3xl mb-8\",children:\"\\u0432\\u0445\\u043E\\u0434/\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u044F \"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:function onSubmit(e){e.preventDefault();!code?getCode(e):login(e);},children:[error?/*#__PURE__*/_jsx(\"p\",{className:\"text-xxs text-red text-center mb-4\",children:error}):'',/*#__PURE__*/_jsx(InputMask,{alwaysShowMask:false,className:\"w-full \".concat(error?'error':''),placeholder:timer?'Введите код':'Введите номер телефона',mask:!timer?\"+7 (999) 999 99 99\":'9999',required:true,autofill:\"false\",id:\"user_phone\",value:timer?code:phoneNumber,onChange:function onChange(e){timer?setCorrectCode(e):setCorrectPhone(e);},maskChar:\"\"}),timer&timer!=='ended'?/*#__PURE__*/_jsx(Countdown,{date:Date.now()+590000,intervalDelay:1000,precision:.3,renderer:renderer,children:/*#__PURE__*/_jsx(Completionist,{})}):null,/*#__PURE__*/_jsxs(\"button\",{className:\"btn grid py-4 px-8 w-fit mx-auto mt-8\",type:\"submit\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C \\u043A\\u043E\\u0434\"}),/*#__PURE__*/_jsx(\"img\",{src:arr,alt:\"\"})]})]})]});}","map":{"version":3,"sources":["/Users/alexandrach/Projects/tresnutye2021/src/components/FormComponent/LoginForm.jsx"],"names":["React","useState","InputMask","API","arr","Countdown","LoginForm","setToken","setForm","timer","setTimer","code","setCode","phoneNumber","setPhone","error","setErrorMessage","renderer","seconds","completed","Completionist","stopTimer","startTimer","e","getCode","setCorrectCode","target","value","preventDefault","post","phone","then","res","success","data","console","log","message","catch","login","confirm_code","token","window","localStorage","setItem","setCorrectPhone","cur","replaceAll","Date","now"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport InputMask from \"react-input-mask\";\nimport API from \"../../utils/API\";\nimport arr from '../../assets/img/btn-arr.png'\nimport Countdown from 'react-countdown';\n\n\n\nexport default function LoginForm({ setToken, setForm }) {\n    const [timer, setTimer] = useState(false)\n    const [code, setCode] = useState('')\n    const [phoneNumber, setPhone] = useState()\n    const [error, setErrorMessage] = useState()\n\n    const renderer = ({ seconds, completed }) => {\n        if (completed) {\n            return <Completionist />;\n        }\n\n        else {\n            return (\n                <div className=\"formCodeAgain\" >\n                    {timer === 'ended' ?\n                        <div className='mt-4 mx-auto text-center'>Код отправлен повторно</div> :\n                        <div className='mt-4 mx-auto text-center'>\n                            Повторная отправка возможна через{' '}\n                            <span className=\"text-violet\">{seconds}</span> сек\n                        </div>\n                    }\n                </div >)\n\n\n        }\n    };\n    const Completionist = () => (\n        <a className=\"underline hover:no-underline text-violet  text-center mt-4 mx-auto block\"\n            onClick={() => stopTimer()}\n        >Отправить повторно</a>\n    );\n    const startTimer = (e) => {\n        setTimer(true)\n\n    }\n\n    // Код отправлен повторно\n    const stopTimer = () => {\n        setTimer('ended')\n        getCode()\n    }\n    const setCorrectCode = e => {\n        setCode(e.target.value)\n    }\n    const getCode = (e) => {\n        e && e.preventDefault()\n        API.post('/login_sms', {\n            phone: phoneNumber\n        }).then(res => {\n            const { success } = res.data\n            console.log(success)\n            if (success) {\n                startTimer()\n                // document.getElementById('#user_phone').value = ''\n            }\n            else if (!success) {\n                res.data.message ? setErrorMessage(res.data.message) : false\n            }\n        })\n            .catch(error => {\n                console.log(error)\n                error.message && setErrorMessage(error.message)\n            })\n    }\n    const login = async () => {\n        await API.post('/sms', {\n            phone: phoneNumber,\n            confirm_code: code\n        })\n            .then(res => {\n                const { success, token } = res.data\n                if (success) {\n                    setToken(token)\n                    window.localStorage.setItem('tresnutye2021-token', token)\n                }\n            })\n    }\n    const setCorrectPhone = (e) => {\n        setErrorMessage(false)\n        let cur = e.target.value\n        cur = cur.replaceAll(/\\s/g, '').replaceAll(/[{()}]/g, '').replaceAll('+', '')\n        setPhone(cur)\n        setCode('')\n    }\n\n    return (\n        <div>\n            <h2 className='text-violet text-center text-3xl mb-8'>\n                вход/регистрация </h2>\n            <form\n                onSubmit={\n                    (e) => {\n                        e.preventDefault();\n                        !code ? getCode(e) : login(e)\n                    }\n                }\n            >\n                {error ? <p className=\"text-xxs text-red text-center mb-4\">{error}</p> : ''}\n                <InputMask\n                    alwaysShowMask={false}\n                    className={`w-full ${error ? 'error' : ''}`}\n                    placeholder={timer ? 'Введите код' : 'Введите номер телефона'}\n                    mask={!timer ? \"+7 (999) 999 99 99\" : '9999'}\n                    required\n                    autofill='false'\n                    id=\"user_phone\"\n                    value={timer ? code : phoneNumber}\n                    onChange={(e) => { timer ? setCorrectCode(e) : setCorrectPhone(e) }}\n                    maskChar=\"\" />\n                {timer & timer !== 'ended' ?\n                    <Countdown date={Date.now() + 590000} intervalDelay={1000} precision={.3} renderer={renderer}>\n                        <Completionist />\n                    </Countdown> : null}\n                <button\n                    className='btn grid py-4 px-8 w-fit mx-auto mt-8'\n                    type='submit'>\n                    <span>отправить код</span>\n                    <img src={arr} alt=\"\" />\n                </button>\n            </form>\n        </div >\n    )\n}"]},"metadata":{},"sourceType":"module"}