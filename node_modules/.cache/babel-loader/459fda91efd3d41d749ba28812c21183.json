{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/alexandrach/Projects/tresnutye2021/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Checkbox,FormControl,FormControlLabel,InputLabel,MenuItem,Select,TextField}from\"@material-ui/core\";import React,{useState,useEffect}from\"react\";import{REGION_LIST}from'../Map/REGION_LIST.js';//import Select from \"react-select\";\nimport{useForm,Controller}from'react-hook-form';import arr from'../../assets/img/btn-arr.png';import API from\"../../utils/API.js\";import axios from\"axios\";import{yupResolver}from'@hookform/resolvers/yup';import*as yup from\"yup\";import{parse,isDate}from\"date-fns\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function parseDateString(value,originalValue){if(originalValue){var parsedDate=isDate(originalValue)?originalValue:parse(originalValue,\"yyyy-MM-dd\",new Date());return parsedDate;}}var schema=yup.object().shape({file:yup.mixed()/*.test('required', \"Загрузите фото коробки с яйцами\", (value) => {\n            return value && value.length\n        })*/.test(\"fileSize\",\"Слишком большой файл\",function(value,context){if(value&&value[0]){return value[0].size<=5000000;}else return true;}).test(\"type\",\"Поддерживаемый тип файла: .jpg\",function(value){if(value&&value[0]){return value[0].type===\"image/jpeg\";}else return true;}),first_name:yup.string().required('Обязательно').min(3,'Минимум 3 символа').max(30,'Максимум 30 символов').matches(/[А-ЯЁA-Z]{2,15}/i,'Только буквы и пробел'),email:yup.string().required('Обязательно').matches(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i,'Неправильный адрес электронной почты'),date:yup.date().required('Обязательно').transform(parseDateString).max(new Date('2003-01-01'),'Не младше 18 лет'),region:yup.string().required('Обязательно'),agree:yup.bool().oneOf([true],'Обязательно')});export default function UserForm(_ref){var userData=_ref.userData,token=_ref.token;//console.log('userData', userData);\nvar _useState=useState({first_name:userData.first_name?userData.first_name:\"\",email:userData.email?userData.email:\"\",file:\"\",region:userData.region?userData.region:\"\",agree:\"\",date:userData.birthday?new Date(userData.birthday.split('.').reverse().join('-')):\"\"}),_useState2=_slicedToArray(_useState,2),values=_useState2[0],setValues=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),file=_useState6[0],setFile=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),sended=_useState8[0],setSended=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),success=_useState10[0],setSuccess=_useState10[1];var handleChange=function handleChange(e){var key=e.target.id;var value=e.target.value;setValues(function(values){return _objectSpread(_objectSpread({},values),{},_defineProperty({},key,value));});setSended(false);setMessage(null);};var setFileValue=function setFileValue(e){setFile(document.getElementById('file').files[0]);};var _useForm=useForm({resolver:yupResolver(schema)}),register=_useForm.register,control=_useForm.control,handleSubmit=_useForm.handleSubmit,errors=_useForm.formState.errors;var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var delta,formData,token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:delta=data.date.getTimezoneOffset()*60000;formData=new FormData();formData.append('first_name',data.first_name);formData.append('email',data.email);formData.append('file',document.getElementById('file').files[0]);formData.append('region',data.region);formData.append('date',new Date(data.date-delta).toISOString());token=window.localStorage.getItem('tresnutye2021-token');setSended(false);setMessage(null);setTimeout(function(){setSended(true);},500);API.post('/eggs_photo',formData,{headers:{'Authorization':\"Bearer \".concat(token)}}).then(function(res){setMessage(res.data.message);setSuccess(res.data.success?true:false);}).catch(function(rej){setMessage('Не удалось отправить. Попробуйте позже.');setSuccess(false);});case 12:case\"end\":return _context.stop();}}},_callee);}));return function onSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"row justify-content-center\",children:[/*#__PURE__*/_jsx(\"header\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"row justify-content-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-auto\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-violet text-5xl mb-4\",children:\"\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-violet\",children:\"\\u041F\\u0440\\u0438\\u043D\\u044F\\u0442\\u044C \\u0443\\u0447\\u0430\\u0441\\u0442\\u0438\\u0435 \\u0432 \\u0440\\u043E\\u0437\\u044B\\u0433\\u0440\\u044B\\u0448\\u0435 \\u043C\\u043E\\u0433\\u0443\\u0442 \\u0442\\u043E\\u043B\\u044C\\u043A\\u043E \\u043B\\u0438\\u0446\\u0430, \\u0434\\u043E\\u0441\\u0442\\u0438\\u0433\\u0448\\u0438\\u0435 18 \\u043B\\u0435\\u0442\"})]})})}),/*#__PURE__*/_jsxs(\"form\",{className:\"mt-8\",onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid lg:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-full\",children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({className:\"w-full\",id:\"first_name\",name:\"first_name\",label:\"\\u0418\\u043C\\u044F\",variant:\"outlined\",error:errors.first_name,value:values.first_name,helperText:errors.first_name&&errors.first_name.message},register(\"first_name\")),{},{onChange:handleChange}))}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full\",children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({label:\"E-mail\",id:\"email\",value:values.email,variant:\"outlined\",error:errors.email,helperText:errors.email&&errors.email.message},register(\"email\")),{},{onChange:handleChange}))}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full\",children:/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({className:\"cursor-pointer\",id:\"date\",variant:\"outlined\",label:\"\\u0414\\u0430\\u0442\\u0430 \\u0440\\u043E\\u0436\\u0434\\u0435\\u043D\\u0438\\u044F\",type:\"date\",defaultValue:userData.birthday&&userData.birthday.split('.').reverse().join('-'),InputLabelProps:{shrink:true},error:errors.date,helperText:errors.date&&errors.date.message},register(\"date\")),{},{onChange:handleChange}))}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full\",children:[/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",children:[/*#__PURE__*/_jsx(InputLabel,{htmlFor:\"outlined-age-native-simple\",children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0440\\u0435\\u0433\\u0438\\u043E\\u043D\"}),/*#__PURE__*/_jsx(Controller,{name:\"region\",control:control,defaultValue:values.region,render:function render(_ref3){var _ref3$field=_ref3.field,value=_ref3$field.value,onChange=_ref3$field.onChange;return/*#__PURE__*/_jsx(Select,{labelId:\"demo-customized-select-label\",value:value,onChange:onChange,label:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0440\\u0435\\u0433\\u0438\\u043E\\u043D\",inputProps:{name:\"Выберите регион\",id:\"outlined-age-native-simple\"},children:REGION_LIST.map(function(item,index){return/*#__PURE__*/_jsx(MenuItem,{value:item.city,children:item.city},index);})});}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-red ml-3\",children:errors.region&&errors.region.message})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full file relative\",children:[/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({type:\"file\",className:\"w-full\",name:\"file\",id:\"file\"},register(\"file\")),{},{onChange:setFileValue})),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"file\",className:\"w-full\",children:[file?file.name:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0444\\u043E\\u0442\\u043E \\u043A\\u043E\\u0440\\u043E\\u0431\\u043A\\u0438 \\u0441 \\u044F\\u0439\\u0446\\u0430\\u043C\\u0438\",/*#__PURE__*/_jsx(\"div\",{className:\"btn lil-btn\",children:\"+\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-red mt-14 ml-3\",children:errors.file&&errors.file.message})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full \",children:[/*#__PURE__*/_jsx(FormControlLabel,_objectSpread(_objectSpread({className:\"w-full check-box\",style:{color:'#520084'},control:/*#__PURE__*/_jsx(Checkbox,{}),id:\"agree\"},register(\"agree\")),{},{label:/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u042F \\u0441\\u043E\\u0433\\u043B\\u0430\\u0441\\u0435\\u043D \\u0441 \",/*#__PURE__*/_jsx(\"a\",{className:\"underline hover:no-underline\",href:\"https://dixy.ru/politika-obrabotki-i-zashity.pdf\",target:\"_blank\",children:\"\\u0443\\u0441\\u043B\\u043E\\u0432\\u0438\\u044F\\u043C\\u0438 \\u043E\\u0431\\u0440\\u0430\\u0431\\u043E\\u0442\\u043A\\u0438 \\u043F\\u0435\\u0440\\u0441\\u043E\\u043D\\u0430\\u043B\\u044C\\u043D\\u044B\\u0445 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445\"})]})})),/*#__PURE__*/_jsx(\"p\",{className:\"text-red\",children:errors.agree&&errors.agree.message})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto\",style:{width:'fit-content',display:'grid'},children:/*#__PURE__*/_jsxs(\"button\",{className:\"btn grid mt-8 py-4 px-8\",type:\"submit\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0441\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"img\",{src:arr,alt:\"\"})]})})]}),sended?message?/*#__PURE__*/_jsx(\"p\",{className:\"text-center mx-auto \".concat(success?'text-green':'text-red',\" mt-8\"),children:message}):/*#__PURE__*/_jsx(\"p\",{className:\"text-center mx-auto text mt-8\",children:\"\\u0412\\u044B\\u043F\\u043E\\u043B\\u043D\\u044F\\u0435\\u0442\\u0441\\u044F...\"}):null]});}","map":{"version":3,"sources":["/Users/alexandrach/Projects/tresnutye2021/src/components/FormComponent/UserForm.jsx"],"names":["Checkbox","FormControl","FormControlLabel","InputLabel","MenuItem","Select","TextField","React","useState","useEffect","REGION_LIST","useForm","Controller","arr","API","axios","yupResolver","yup","parse","isDate","parseDateString","value","originalValue","parsedDate","Date","schema","object","shape","file","mixed","test","context","size","type","first_name","string","required","min","max","matches","email","date","transform","region","agree","bool","oneOf","UserForm","userData","token","birthday","split","reverse","join","values","setValues","message","setMessage","setFile","sended","setSended","success","setSuccess","handleChange","e","key","target","id","setFileValue","document","getElementById","files","resolver","register","control","handleSubmit","errors","formState","onSubmit","data","delta","getTimezoneOffset","formData","FormData","append","toISOString","window","localStorage","getItem","setTimeout","post","headers","then","res","catch","rej","shrink","field","onChange","name","map","item","index","city","color","width","display"],"mappings":"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","sourcesContent":["import { Checkbox, FormControl, FormControlLabel, InputLabel, MenuItem, Select, TextField } from \"@material-ui/core\";\nimport React, { useState, useEffect } from \"react\";\nimport { REGION_LIST } from '../Map/REGION_LIST.js'\n//import Select from \"react-select\";\nimport { useForm, Controller } from 'react-hook-form'\nimport arr from '../../assets/img/btn-arr.png'\nimport API from \"../../utils/API.js\";\nimport axios from \"axios\";\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport * as yup from \"yup\";\nimport { parse, isDate } from \"date-fns\";\n\nfunction parseDateString(value, originalValue) {\n    if (originalValue) {\n        const parsedDate = isDate(originalValue)\n            ? originalValue\n            : parse(originalValue, \"yyyy-MM-dd\", new Date());\n\n        return parsedDate;\n    }\n}\n\n\n\nconst schema = yup.object().shape({\n    file: yup.mixed()\n        /*.test('required', \"Загрузите фото коробки с яйцами\", (value) => {\n            return value && value.length\n        })*/\n        .test(\"fileSize\", \"Слишком большой файл\", (value, context) => {\n          if (value && value[0]) {\n              return value[0].size <= 5000000;\n            } else return true;\n        })\n        .test(\"type\", \"Поддерживаемый тип файла: .jpg\", function (value) {\n          if (value && value[0]) {\n            return value[0].type === \"image/jpeg\";\n          } else return true;\n        }),\n    first_name: yup.string()\n        .required('Обязательно')\n        .min(3, 'Минимум 3 символа')\n        .max(30, 'Максимум 30 символов')\n        .matches(/[А-ЯЁA-Z]{2,15}/i, 'Только буквы и пробел'),\n    email: yup.string()\n        .required('Обязательно')\n        .matches(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i, 'Неправильный адрес электронной почты'),\n    date: yup.date()\n        .required('Обязательно')\n        .transform(parseDateString)\n        .max(new Date('2003-01-01'), 'Не младше 18 лет'),\n    region: yup.string()\n        .required('Обязательно'),\n    agree: yup.bool().oneOf([true], 'Обязательно'),\n\n});\n\n\nexport default function UserForm({ userData, token }) {\n\n  //console.log('userData', userData);\n    const [values, setValues] = useState({\n        first_name: userData.first_name ? userData.first_name : \"\",\n        email: userData.email ? userData.email : \"\",\n        file: \"\",\n        region: userData.region ? userData.region : \"\",\n        agree: \"\",\n        date: userData.birthday ? new Date(userData.birthday.split('.').reverse().join('-')) : \"\"\n    })\n\n    const [message, setMessage] = useState(false)\n    const [file, setFile] = useState()\n    const [sended, setSended] = useState(false);\n    const [success, setSuccess] = useState(false);\n\n    const handleChange = (e) => {\n        const key = e.target.id;\n        const value = e.target.value;\n        setValues(values => ({\n            ...values,\n            [key]: value,\n        }))\n        setSended(false);\n        setMessage(null);\n    }\n\n    const setFileValue = (e) => {\n        setFile(document.getElementById('file').files[0])\n    }\n\n    const { register, control, handleSubmit, formState: { errors } } = useForm({\n        resolver: yupResolver(schema),\n    });\n\n    const onSubmit = async data => {\n        let delta = data.date.getTimezoneOffset() * 60000;\n        let formData = new FormData();\n        formData.append('first_name', data.first_name)\n        formData.append('email', data.email)\n        formData.append('file', document.getElementById('file').files[0])\n        formData.append('region', data.region)\n        formData.append('date', (new Date(data.date - delta)).toISOString())\n\n        let token = window.localStorage.getItem('tresnutye2021-token');\n        setSended(false);\n        setMessage(null);\n        setTimeout(() => {\n          setSended(true);\n        }, 500);\n\n        API.post('/eggs_photo', formData, { headers: {\n          'Authorization': `Bearer ${token}`,\n        } })\n            .then(\n                res => {\n                    setMessage(res.data.message)\n                    setSuccess(res.data.success ? true : false)\n                }\n            )\n            .catch(\n                rej => {\n                    setMessage('Не удалось отправить. Попробуйте позже.')\n                    setSuccess(false)\n                }\n            )\n    };\n\n\n    return (\n        <div className=\"row justify-content-center\">\n            <header >\n                <div className=\"row justify-content-center\">\n                    <div className=\"col-lg-auto\">\n                        <h2 className='text-violet text-5xl mb-4'>\n                            регистрация\n                        </h2>\n                        <p className='text-violet'>Принять участие в розыгрыше могут только лица, достигшие 18 лет</p>\n                    </div>\n                </div>\n\n            </header>\n            <form\n                className='mt-8'\n                onSubmit={handleSubmit(onSubmit)}\n            >\n                <div className=\"grid lg:grid-cols-2 gap-4\">\n                    <div className=\"w-full\">\n                        <TextField\n                            className=\"w-full\"\n                            id=\"first_name\"\n                            name=\"first_name\"\n                            label=\"Имя\"\n                            variant=\"outlined\"\n                            error={errors.first_name}\n                            value={values.first_name}\n                            helperText={errors.first_name && errors.first_name.message}\n                            {...register(\"first_name\")}\n                            onChange={handleChange}\n                        />\n\n                    </div>\n                    <div className=\"w-full\">\n                        <TextField\n                            label=\"E-mail\"\n                            id=\"email\"\n                            value={values.email}\n                            variant=\"outlined\"\n                            error={errors.email}\n                            helperText={errors.email && errors.email.message}\n                            {...register(\"email\")}\n                            onChange={handleChange}\n                        />\n                    </div>\n                    <div className=\"w-full\">\n                        <TextField\n                            className='cursor-pointer'\n                            id=\"date\"\n                            variant=\"outlined\"\n                            label=\"Дата рождения\"\n                            type=\"date\"\n                            defaultValue={userData.birthday && userData.birthday.split('.').reverse().join('-')}\n                            InputLabelProps={{\n                                shrink: true,\n                            }}\n                            error={errors.date}\n                            helperText={errors.date && errors.date.message}\n                            {...register(\"date\")}\n                            onChange={handleChange}\n                        />\n                    </div>\n                    <div className=\"w-full\">\n                        <FormControl variant=\"outlined\">\n                            <InputLabel htmlFor=\"outlined-age-native-simple\">\n                                Выберите регион\n                            </InputLabel>\n                            <Controller\n                                name=\"region\"\n                                control={control}\n                                defaultValue={values.region}\n                                render={({ field: { value, onChange } }) => (\n                                    <Select\n                                        labelId=\"demo-customized-select-label\"\n                                        value={value}\n                                        onChange={onChange}\n                                        label=\"Выберите регион\"\n                                        inputProps={{\n                                            name: \"Выберите регион\",\n                                            id: \"outlined-age-native-simple\",\n                                        }}\n                                    >\n                                        {REGION_LIST.map((item, index) => (\n                                            <MenuItem value={item.city} key={index}>{item.city}</MenuItem>\n                                        ))}\n                                    </Select>)\n                                }\n                            />\n\n                        </FormControl>\n                        <div className='text-red ml-3'>{errors.region && errors.region.message}</div>\n                    </div>\n                    <div className=\"w-full file relative\">\n                        <input\n                            type=\"file\"\n                            className=\"w-full\"\n                            name=\"file\"\n                            id=\"file\"\n                            {...register(\"file\")}\n                            onChange={setFileValue}\n                        />\n                        <label htmlFor=\"file\" className='w-full'>{file ? file.name : `Загрузить фото коробки с яйцами`}\n                            <div className=\"btn lil-btn\">+</div>\n                        </label>\n                        <div className='text-red mt-14 ml-3'>{errors.file && errors.file.message}</div>\n                    </div>\n                    <div className=\"w-full \">\n                        <FormControlLabel\n                            className='w-full check-box'\n                            style={{ color: '#520084' }}\n                            control={<Checkbox />}\n                            id=\"agree\"\n                            {...register(\"agree\")}\n                            label={<p>Я согласен с <a className='underline hover:no-underline' href='https://dixy.ru/politika-obrabotki-i-zashity.pdf' target='_blank'>условиями обработки персональных данных</a></p>}\n                        />\n                        <p className='text-red'>{errors.agree && errors.agree.message}</p>\n                    </div>\n                </div>\n\n                <div className=\"mx-auto\" style={{ width: 'fit-content', display: 'grid' }}>\n                    <button className='btn grid mt-8 py-4 px-8' type='submit'>\n                        <span>сохранить</span>\n                        <img src={arr} alt=\"\" />\n                    </button>\n\n                </div>\n            </form>\n            {\n                sended ?\n                    message ?\n                        <p className={`text-center mx-auto ${success ? 'text-green' : 'text-red'} mt-8`}>{message}</p>\n                    :\n                        <p className='text-center mx-auto text mt-8'>Выполняется...</p>\n                : null\n            }\n        </div>\n    )\n\n}\n"]},"metadata":{},"sourceType":"module"}